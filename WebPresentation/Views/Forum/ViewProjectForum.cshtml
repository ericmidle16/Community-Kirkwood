<!--
/// <summary>
/// Creator: Jackson Manternach
/// Created: 2025/04/07
/// Summary: View for a project's forum, displays threads for a specific project
///
/// Last Updated By: Nik Bell & Kate Rich
/// Last Updated: 2025-04-18
/// What Was Changed: Updated the link to the Details view to route to the PostsController's Index method.
///
/// Last Updated By: Syler Bushlack
/// Last Updated: 2025-04-24
/// What Was Changed: Added link to mute volunteers page and changed the details link to include the projectID
///
/// Last Updated By: Skyann Heintz
/// Last Updated: 2025-04-28
/// What Was Changed: Added styling
///
/// Last Updated By: Dat Tran
/// Last Updated: 2025-04-27
/// What Was Changed: Added Sweet Alert for creating a project forum.
/// </summary>
-->
@model IEnumerable<DataDomain.ThreadVM>

@{
    ViewData["Title"] = "Project Forum";
}

<div class="text-center mb-4">
    <h1>Welcome to the @ViewBag.ProjectName Forum!</h1>
</div>
@if (TempData["SuccessMessage"] != null)
{
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            if (!sessionStorage.getItem('sweetAlertCreateThreadShown')) {
                Swal.fire({
                    icon: 'success',
                    title: 'Done',
                    text: '@TempData["SuccessMessage"]'
                });
                sessionStorage.setItem('sweetAlertCreateThreadShown', 'true');
            }
        });
    </script>
    @* Remove the message so it doesn’t persist on refresh *@
    TempData.Remove("SuccessMessage");
}
else
{
    <script>
        // Ensure the flag is reset if there's no success message
        sessionStorage.removeItem('sweetAlertCreateThreadShown');
    </script>
}

<div class="mb-3 d-flex gap-2">
    <a asp-controller="Forum" class="btn btn-success" asp-action="CreateThread" asp-route-projectId="@ViewBag.ProjectID">Create New Thread</a>
    <a href="@Url.Action("Index", "ForumPermission", new { projectID = ViewBag.ProjectID })" class="btn btn-info">Mute Volunteers</a>

</div>



@if (Model != null && Model.Any())
{
    <table class="table table-striped table-bordered table-hover">
        <thead class="thead-dark">
            <tr>
                <th class="header">Thread Name</th>
                <th class="header">Posted By</th>
                <th class="header">Date Posted</th>
                <th class="header"></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var thread in Model)
            {
                <tr>
                    <td>@thread.ThreadName</td>
                    <td>@thread.GivenName @thread.FamilyName</td>
                    <td>@thread.DatePosted.ToShortDateString()</td>
                    <td>
                        <div class="d-flex flex-wrap justify-content-center gap-2">
                            <a asp-controller="Posts" asp-action="Index" asp-route-id="@thread.ThreadID" asp-route-projectID="@ViewBag.ProjectID" class="btn btn-primary btn-sm">Details</a>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <div class="alert alert-info text-center">No threads found for this project.</div>
}
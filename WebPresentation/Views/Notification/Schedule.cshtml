<!--
    /// <summary>
    /// Creator: Brodie
    /// Created: 2025-04-24
    /// Summary: View for creating a notification
    ///
    /// Updated By: Skyann Heintz
    /// Updated: 2025-04-30
    /// What Was Changed: I did styling to the "New Notification" button to "Create New Notification".a
        I also changed it's color.
-->

@model WebPresentation.Models.ScheduleNotificationsViewModel
@{
    Layout = "_Layout";
}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    .calendar-cell {
        height: 100px;
        padding: 2px;
        position: relative;
        cursor: pointer;
        transition: background-color 0.2s;
    }

    .badge-container {
        position: absolute;
        bottom: 4px;
        left: 0;
        right: 0;
        display: flex;
        justify-content: space-between;
        padding: 0 4px;
        pointer-events: none;
    }

    .non-current-month {
        background-color: #f8f9fa;
    }

        .non-current-month .day-number {
            color: #adb5bd !important;
        }

    .selected-day {
        background-color: #e3f2fd !important;
        border: 2px solid #2196F3 !important;
    }

    .calendar-legend .badge {
        width: 1.2rem;
        height: 1.2rem;
    }

    .calendar-legend .bg-danger {
        background-color: #dc3545 !important;
    }

    .calendar-legend .bg-secondary {
        background-color: #6c757d !important;
    }

    .calendar-legend .bg-primary {
        background-color: #0d6efd !important;
    }

    .today-number {
        font-weight: bold;
        color: #0d6efd;
    }

    .day-number {
        position: absolute;
        top: 4px;
        left: 4px;
    }
</style>

<h2>Schedule Notifications</h2>

<div class="calendar-legend mb-3">
    <span class="badge bg-danger"></span>Important
    <span class="badge rounded-pill bg-secondary"></span>Unimportant
    <span class="badge bg-primary ms-3"></span>Total
</div>

<div class="row">
    <!-- Calendar Column -->
    <div class="col-md-8">
        <div class="d-flex mb-2">
            <a asp-action="Schedule" asp-route-year="@Model.Year" asp-route-month="@(Model.Month-1)"
               class="btn btn-secondary">&lt; Prev</a>
            <div class="mx-3 fw-bold align-self-center">@Model.DisplayMonthYear</div>
            <a asp-action="Schedule" asp-route-year="@Model.Year" asp-route-month="@(Model.Month+1)"
               class="btn btn-secondary">Next &gt;</a>
            <a asp-action="Create" asp-route-year="@Model.Year" asp-route-month="@Model.Month"
               class="btn btn-success ms-auto">Create New Notification</a>
        </div>

        <table class="table table-bordered">
            <thead>
                <tr>
                    @foreach (var d in new[] { "Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat" })
                    {
                        <th class="text-center">@d</th>
                    }
                </tr>
            </thead>
            <tbody>
                @for (int week = 0; week < 5; week++)
                {
                    <tr>
                        @for (int day = 0; day < 7; day++)
                        {
                            var cell = Model.Calendar[week * 7 + day];
                            var impCount = cell.Notifications.Count(n => n.Important);
                            var unimpCount = cell.Notifications.Count - impCount;

                            <td class="align-top calendar-cell
                                    @(cell.IsCurrentMonth ? "" : "non-current-month")
                                    @(cell.Date == Model.SelectedDate ? "selected-day" : "")">
                                <a asp-action="Schedule"
                                   asp-route-year="@Model.Year"
                                   asp-route-month="@Model.Month"
                                   asp-route-selectedDate="@cell.Date.ToString("yyyy-MM-dd")"
                                   class="d-block h-100 w-100 text-decoration-none text-reset">
                                    <div class="position-relative h-100">
                                        <!-- Day Number -->
                                        <span class="day-number @(cell.IsToday ? "today-number" : "")">
                                            @cell.Date.Day
                                        </span>

                                        <!-- Notification Badges -->
                                        <div class="badge-container">
                                            @if (unimpCount > 0)
                                            {
                                                <span class="badge rounded-pill bg-secondary">@unimpCount</span>
                                            }
                                            else
                                            {
                                                <span class="badge rounded-pill bg-transparent"></span>
                                            }

                                            @if (cell.Notifications.Count > 0)
                                            {
                                                <span class="badge rounded-pill bg-primary">@cell.Notifications.Count</span>
                                            }
                                            else
                                            {
                                                <span class="badge rounded-pill bg-transparent"></span>
                                            }

                                            @if (impCount > 0)
                                            {
                                                <span class="badge rounded-pill bg-danger">@impCount</span>
                                            }
                                            else
                                            {
                                                <span class="badge rounded-pill bg-transparent"></span>
                                            }
                                        </div>
                                    </div>
                                </a>
                            </td>
                        }
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Detail Column -->
    <div class="col-md-4">
        <h4>Notifications for @Model.SelectedDate.ToString("MMMM d, yyyy")</h4>
        @if (!Model.SelectedNotifications.Any())
        {
            <p><em>No notifications scheduled.</em></p>
        }
        else
        {
            <ul class="list-group">
                @foreach (var n in Model.SelectedNotifications)
                {
                    <li class="list-group-item">
                        <strong>@n.Name</strong><br>
                        @n.Content <br>
                        <em>Important: @(n.Important ? "Yes" : "No")</em><br>
                        <small class="text-muted">
                            @n.StartDate.ToString("MM/dd/yyyy") – @n.EndDate.ToString("MM/dd/yyyy")
                        </small>
                    </li>
                }
            </ul>
        }
    </div>
</div>